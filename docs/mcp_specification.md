# Model Context Protocol (MCP) Specification

## Overview

The Model Context Protocol (MCP) is the foundational communication protocol for Pandacea's consent-driven data ecosystem. It enables structured data requests with explicit purpose declarations, user consent management, and compensation tracking.

**Version**: 1.1.0

## Core Components

The MCP protocol consists of two main message types:

1. **McpRequest**: Initiated by a requestor (application, AI agent, etc.) asking for access to data or permission to perform an action.
2. **McpResponse**: Generated by a responder (typically a Consent Manager) providing a decision on the request.

## Protocol Flow

```
┌──────────┐                               ┌──────────┐
│          │                               │          │
│ Requestor│                               │ Responder│
│          │                               │(Consent  │
│          │                               │ Manager) │
└────┬─────┘                               └────┬─────┘
     │                                          │
     │ 1. Formulate request with:              │
     │    - Purpose DNA                        │
     │    - Identity                           │
     │    - Permissions                        │
     │    - Compensation model                 │
     │                                         │
     │ 2. Sign request                         │
     │                                         │
     │ 3. Send McpRequest                      │
     │ ─────────────────────────────────────> │
     │                                         │
     │                                         │ 4. Validate request syntax
     │                                         │
     │                                         │ 5. Validate semantics
     │                                         │
     │                                         │ 6. Verify signature
     │                                         │
     │                                         │ 7. Evaluate against policies
     │                                         │
     │                                         │ 8. Make consent decision
     │                                         │
     │                                         │ 9. Create & sign response
     │                                         │
     │ 10. McpResponse                         │
     │ <─────────────────────────────────────  │
     │                                         │
     │ 11. Validate response                   │
     │                                         │
     │ 12. Process according to decision       │
     │                                         │
     │ [If approved]                           │
     │ 13. Access data with constraints        │
     │                                         │
     │ 14. Process compensation                │
     └─────────────────────────────────────────┘
```

## Key Protocol Features

### 1. Purpose Declaration (Purpose DNA)

The Purpose DNA is a structured representation of why data is being requested:

- **Primary purpose category**: High-level classification (e.g., ANALYTICS, RESEARCH_DEVELOPMENT)
- **Specific purpose description**: Detailed explanation for human readability
- **Data types involved**: List of data categories or fields being requested
- **Processing description**: How the data will be used
- **Storage details**: Where and how long data will be stored
- **Impact assessment**: Potential impact on individuals
- **Reuse limitations**: Whether and how data can be repurposed

### 2. Requestor Identity and Authentication

The protocol provides strong identity and authentication mechanisms:

- **Pseudonym ID**: Stable identifier for the requestor
- **Public key**: For signature verification
- **Organization information**: If part of a larger entity
- **Authentication method**: How the requestor was authenticated (PASSWORD, OAUTH, MFA, etc.)
- **Authentication level**: Strength of the authentication (BASIC, STRONG, etc.)

### 3. Permission Specification

Each permission specifies:

- **Resource identifier**: What data or resource is being requested
- **Action**: What the requestor wants to do (READ, WRITE, DELETE, EXECUTE, OBSERVE)
- **Constraints**: Fine-grained limits on the permission
- **Sensitivity level**: How sensitive or critical the resource is
- **Justification**: Explanation of why this permission is needed

### 4. Compensation Model

The protocol supports various compensation mechanisms:

- **Compensation type**: MONETARY, TOKEN, SERVICE_ACCESS, REVENUE_SHARE, etc.
- **Amount and unit**: Specific compensation value and currency
- **Payment method**: How payment will be processed
- **Revenue sharing model**: For ongoing compensation based on value derived

### 5. Trust Information

Trust indicators help responders evaluate requests:

- **Trust score**: Numerical measure of trustworthiness
- **Assessment method**: How trust was evaluated
- **Trust credentials**: Certifications or attestations

## Message Validation

The protocol validates messages in three stages:

1. **Syntax validation**: Ensures all required fields are present and correctly formatted
2. **Semantic validation**: Checks that the message is logically coherent
3. **Security validation**: Verifies cryptographic signatures

## Request-Response Flow Example

### Example Request

```protobuf
// McpRequest example
{
  "request_id": "req-5d289ac3-19f4-49c2-b1c6-8879e5d54428",
  "timestamp": "2023-06-15T14:35:22Z",
  "requestor_identity": {
    "pseudonym_id": "org:airesearch:agent42",
    "display_name": "Research Assistant Alpha",
    "requestor_type": "AI_AGENT"
  },
  "purpose_dna": {
    "purpose_id": "purpose:research:sentiment-analysis",
    "primary_purpose_category": "RESEARCH_DEVELOPMENT",
    "specific_purpose_description": "Analyzing sentiment patterns in user feedback",
    "data_types_involved": ["user.feedback.text", "user.feedback.rating"],
    "processing_description": "Text will be analyzed using NLP to extract sentiment",
    "storage_description": "Data stored encrypted for 30 days maximum",
    "impact_assessment": "Minimal impact, used only for aggregate insights"
  },
  "permissions": [
    {
      "resource_identifier": "user.feedback.text",
      "requested_action": "READ",
      "sensitivity_level": "MEDIUM"
    },
    {
      "resource_identifier": "user.feedback.rating",
      "requested_action": "READ",
      "sensitivity_level": "LOW"
    }
  ],
  "compensation_model": {
    "compensation_type": "TOKEN",
    "amount": 0.25,
    "unit": "DATA_TOKEN"
  },
  "signature": {
    "key_id": "key-f390dea7",
    "algorithm": "Ed25519",
    "signature": "base64-encoded-signature-data"
  },
  "mcp_version": "1.1.0"
}
```

### Example Response

```protobuf
// McpResponse example
{
  "response_id": "resp-78ad4e21-90c5-4738-b6a3-cc7a0db4f291",
  "request_id": "req-5d289ac3-19f4-49c2-b1c6-8879e5d54428",
  "timestamp": "2023-06-15T14:35:25Z",
  "status": "APPROVED",
  "consent_expiry": "2023-07-15T14:35:25Z",
  "compensation_receipt": {
    "transaction_id": "tx-9a7b54c2",
    "timestamp": "2023-06-15T14:35:26Z",
    "amount": 0.25,
    "unit": "DATA_TOKEN",
    "status": "COMPLETED"
  },
  "usage_limitations": {
    "max_retention_days": 30,
    "must_delete_after_use": true,
    "geographic_restrictions": ["EU"]
  },
  "signature": {
    "key_id": "consent-manager-key-8293",
    "algorithm": "Ed25519",
    "signature": "base64-encoded-signature-data"
  },
  "mcp_version": "1.1.0"
}
```

## Use Cases

The MCP protocol supports various use cases:

1. **AI model training authorization**: Request access to train models on user data
2. **Personal data access**: Request access to personal data for specific services
3. **Data monetization**: Compensate users for their data contributions
4. **Cross-application consent**: Manage consent across different applications
5. **Algorithmic transparency**: Document how and why data is used in algorithmic decisions

## Security Considerations

- **Signature verification**: All messages must be cryptographically signed
- **Tamper protection**: Any modification to signed fields invalidates the signature
- **Key management**: Proper key rotation and management practices required
- **Trust verification**: Usage of attestations and verifiable credentials

## Privacy Protections

- **Purpose limitation**: Data can only be used for the declared purpose
- **Data minimization**: Only necessary data is requested
- **Transparent processing**: Clear descriptions of how data will be processed
- **User control**: Explicit consent decisions for each request
- **Usage limitations**: Constraints on how approved data can be used

## Extending the Protocol

The protocol can be extended through:

1. **Extensions field**: For adding custom data without breaking compatibility
2. **New message fields**: In backwards-compatible protocol updates
3. **Constraint mechanisms**: For domain-specific limitations

## Implementation Guidelines

When implementing the MCP protocol:

1. Validate all messages thoroughly
2. Implement proper cryptographic signature verification
3. Store consent decisions securely
4. Enforce usage limitations and constraints
5. Implement proper compensation tracking
6. Maintain audit logs of all requests and responses

## Conclusion

The Model Context Protocol provides a comprehensive framework for consent-driven data interactions with clear purpose declarations, explicit permissions, and fair compensation. It enables building data ecosystems that respect individual agency while unlocking the value of data. 